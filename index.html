<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Basma Games</title>
<style>
:root{--bg:#eaf2ff;--card:#fff;--accent:#1e6fff;--muted:#6b7280;}
*{box-sizing:border-box}body{margin:0;font-family:Inter,system-ui,Arial,sans-serif;background:var(--bg);color:#0f172a}
.container{max-width:1100px;margin:18px auto;padding:16px}
.header{display:flex;align-items:center;gap:12px;justify-content:space-between}
.brand{display:flex;align-items:center;gap:12px}
.logo{width:56px;height:56px;border-radius:10px;background:linear-gradient(135deg,var(--accent),#49a1ff);display:flex;align-items:center;justify-content:center;color:white;font-weight:700;font-size:18px;box-shadow:0 6px 18px rgba(30,111,255,.18)}
.title{font-size:20px;font-weight:700}
.controls{display:flex;gap:8px;align-items:center}
.btn{background:var(--accent);color:white;border:none;padding:8px 12px;border-radius:8px;cursor:pointer}
.btn.ghost{background:transparent;color:var(--accent);border:1px solid rgba(30,111,255,.15)}
.card{background:var(--card);border-radius:12px;padding:12px;box-shadow:0 6px 18px rgba(15,23,42,.04);margin-top:12px}
.flex{display:flex;gap:12px}
.col{flex:1}
.small{font-size:13px;color:var(--muted)}
.input, textarea, select{width:100%;padding:8px;border:1px solid #e6eefc;border-radius:8px;font-size:14px}
.row{display:flex;gap:8px}
.img-thumb{width:100%;height:80px;object-fit:cover;border-radius:6px;border:1px solid #eef6ff}
.grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(160px,1fr));gap:12px;margin-top:12px}
.card-click{cursor:pointer;border:1px dashed #e6f0ff;padding:8px;border-radius:8px;text-align:center;background:white}
.footer{font-size:13px;color:var(--muted);margin-top:16px;text-align:center}
.tabbar{display:flex;gap:8px;margin-top:12px;flex-wrap:wrap}
.tab{padding:8px 12px;border-radius:8px;border:1px solid rgba(0,0,0,0.06);cursor:pointer;background:white}
@media(max-width:800px){.flex{flex-direction:column} .controls{flex-wrap:wrap} .tabbar{overflow:auto}}
</style>
</head>
<body>
<div class="container" id="app">
  <div class="header">
    <div class="brand">
      <div class="logo" aria-hidden="true">BG</div>
      <div>
        <div class="title" id="siteTitle">Basma Games</div>
        <div class="small" id="siteDesc">Create and play educational games</div>
      </div>
    </div>
    <div class="controls">
      <button class="btn ghost" onclick="window.location.href='https://basmasalah825.github.io'">← Back</button>
      <select id="uiLang" class="input" style="width:140px" onchange="setUiLang(this.value)">
        <option value="en">English</option>
        <option value="ar">العربية</option>
      </select>
    </div>
  </div>

  <div class="card">
    <div style="display:flex;align-items:center;justify-content:space-between">
      <div><strong id="pageTitle">Game Studio</strong><div class="small" id="pageSub">Choose a template and edit.</div></div>
      <div style="display:flex;gap:8px">
        <button class="btn" onclick="saveAll()">Save All</button>
        <button class="btn ghost" onclick="downloadAll()">Download All</button>
      </div>
    </div>

    <div class="tabbar" id="tabs" role="tablist" aria-label="Game types">
      <div class="tab" data-tab="pairs" onclick="switchTab('pairs')" role="tab">Match in Pairs</div>
      <div class="tab" data-tab="flash" onclick="switchTab('flash')" role="tab">Flashcards</div>
      <div class="tab" data-tab="matching" onclick="switchTab('matching')" role="tab">Matching</div>
      <div class="tab" data-tab="mcq" onclick="switchTab('mcq')" role="tab">Quiz (MCQ)</div>
      <div class="tab" data-tab="library" onclick="switchTab('library')" role="tab">Image Library</div>
    </div>

    <div id="editorArea" class="card" style="margin-top:12px" aria-live="polite"></div>
  </div>

  <div id="playArea" class="card" style="display:none;margin-top:12px"></div>

  <div class="footer">Built for Basma — Games & images are stored in your browser (localStorage). Use Download to export standalone HTML files.</div>
</div>

<script>
/* Basma Games — single-file multi-game studio
   Features: Match in Pairs, Flashcards, Matching, MCQ, Image Library (upload + save in localStorage)
*/

const STORAGE = 'basma_games_all_v2';
const IMGLIB = 'basma_images_v2';
let state = { games: {}, images: [] };

function uid(){ return Math.random().toString(36).slice(2,9); }

const TEMPLATES = {
  pairs: { id: uid(), type:'pairs', title:'New Pairs', language:'en', items:[] },
  flash: { id: uid(), type:'flashcard', title:'New Flashcards', language:'en', items:[] },
  matching: { id: uid(), type:'matching', title:'New Matching', language:'en', items:[] },
  mcq: { id: uid(), type:'mcq', title:'New Quiz', language:'en', items:[] }
};

function load(){
  try{
    const raw = localStorage.getItem(STORAGE);
    const rawImg = localStorage.getItem(IMGLIB);
    if(raw) state = JSON.parse(raw);
    else { state.games = { pairs: TEMPLATES.pairs, flash: TEMPLATES.flash, matching: TEMPLATES.matching, mcq: TEMPLATES.mcq }; state.images = []; save(); }
    if(rawImg) state.images = JSON.parse(rawImg);
  }catch(e){ console.error(e); state = { games: { pairs: TEMPLATES.pairs, flash: TEMPLATES.flash, matching: TEMPLATES.matching, mcq: TEMPLATES.mcq }, images: [] }; save(); }
  switchTab('pairs');
}

function save(){ localStorage.setItem(STORAGE, JSON.stringify(state)); localStorage.setItem(IMGLIB, JSON.stringify(state.images)); }

function switchTab(tab){
  document.querySelectorAll('.tab').forEach(t=> t.style.background='white');
  const el = document.querySelector('.tab[data-tab="'+tab+'"]'); if(el) el.style.background='linear-gradient(90deg,var(--accent),#49a1ff)';
  renderEditor(tab);
}

function renderEditor(tab){
  const area = document.getElementById('editorArea'); area.innerHTML='';
  const g = state.games[tab];
  if(!g){
    if(tab==='library'){ renderImageLibrary(area); return; }
    area.innerText='Unknown tab'; return;
  }

  // header row
  const header = document.createElement('div'); header.style.display='flex'; header.style.justifyContent='space-between'; header.style.alignItems='center';
  const left = document.createElement('div');
  const titleInput = document.createElement('input'); titleInput.className='input'; titleInput.value = g.title; titleInput.onchange = ()=>{ g.title = titleInput.value; save(); renderEditor(tab); };
  left.appendChild(titleInput);
  const lang = document.createElement('select'); lang.className='input'; lang.style.width='140px'; lang.value = g.language; lang.onchange = ()=>{ g.language = lang.value; save(); };
  lang.innerHTML = '<option value="en">English</option><option value="ar">العربية</option>';
  left.appendChild(lang);
  header.appendChild(left);

  const actions = document.createElement('div');
  const addBtn = document.createElement('button'); addBtn.className='btn'; addBtn.innerText='Add Item'; addBtn.onclick = ()=> openAddItemDialog(tab);
  const playBtn = document.createElement('button'); playBtn.className='btn ghost'; playBtn.style.marginLeft='8px'; playBtn.innerText='Play'; playBtn.onclick = ()=> playGame(tab);
  actions.appendChild(addBtn); actions.appendChild(playBtn);
  header.appendChild(actions);
  area.appendChild(header);

  // items list
  const list = document.createElement('div'); list.style.marginTop='12px';
  const grid = document.createElement('div'); grid.className='grid';
  g.items.forEach(it=>{
    const card = document.createElement('div'); card.className='card-click';
    if(it.kind==='image') card.innerHTML = '<img src="'+it.content+'" class="img-thumb" />';
    else card.innerHTML = '<div style="font-size:16px">'+escapeHtml(it.content||it.front||'')+'</div>';
    const meta = document.createElement('div'); meta.className='small'; meta.innerText = it.pairId ? ('pair: '+it.pairId) : '';
    const del = document.createElement('button'); del.className='btn ghost'; del.style.marginTop='6px'; del.innerText='Delete'; del.onclick = ()=>{ if(confirm('Delete item?')){ g.items = g.items.filter(x=>x.id!==it.id); save(); renderEditor(tab); } };
    card.appendChild(meta); card.appendChild(del);
    grid.appendChild(card);
  });
  list.appendChild(grid);
  area.appendChild(list);

  if(tab==='mcq'){
    const hint = document.createElement('div'); hint.className='small'; hint.style.marginTop='8px'; hint.innerText='MCQ: each item should include question, choices (comma separated), answerIndex (0-based). Use Add Item to add questions.';
    area.appendChild(hint);
  }
}

function openAddItemDialog(tab){
  const g = state.games[tab];
  const kind = prompt('Item type: text, image, or mcq? (enter text/image/mcq)','text');
  if(!kind) return;
  if(kind==='text'){
    const content = prompt('Enter text content');
    if(!content) return;
    const pairId = prompt('Pair ID (use same id for linked items)') || ('p'+Math.random().toString(36).slice(2,5));
    g.items.push({ id: uid(), kind:'text', content, pairId });
    save(); renderEditor(tab);
  } else if(kind==='mcq' && tab==='mcq'){
    const question = prompt('Question text');
    if(!question) return;
    const choices = prompt('Choices comma separated (e.g. A,B,C)');
    const arr = (choices||'').split(',').map(s=>s.trim());
    const ai = parseInt(prompt('Answer index (0-based)'),10) || 0;
    g.items.push({ id: uid(), question, choices: arr, answerIndex: ai });
    save(); renderEditor(tab);
  } else {
    const choice = prompt('Type "upload" to upload from your device, or "choose" to pick from library','upload');
    if(choice==='choose'){
      const id = prompt('Enter image id to use (see Image Library)');
      const img = state.images.find(i=>i.id===id);
      if(!img){ alert('Image not found'); return; }
      const pairId = prompt('Pair ID (use same id for linked items)') || ('p'+Math.random().toString(36).slice(2,5));
      g.items.push({ id: uid(), kind:'image', content: img.data, pairId });
      save(); renderEditor(tab);
    } else {
      const inp = document.createElement('input'); inp.type='file'; inp.accept='image/*'; inp.onchange = (e)=>{
        const f = e.target.files[0]; if(!f) return;
        const reader = new FileReader(); reader.onload = ()=>{
          const data = reader.result; const img = { id: 'img'+uid(), name: f.name, data, createdAt: Date.now() };
          state.images.unshift(img); save();
          const pairId = prompt('Pair ID (use same id for linked items)') || ('p'+Math.random().toString(36).slice(2,5));
          g.items.push({ id: uid(), kind:'image', content: img.data, pairId });
          save(); renderEditor(tab);
        }; reader.readAsDataURL(f);
      }; inp.click();
    }
  }
}

function renderImageLibrary(areaOverride){
  const area = areaOverride || document.getElementById('editorArea');
  area.innerHTML = '<h4>Image Library</h4>';
  const top = document.createElement('div'); top.style.display='flex'; top.style.gap='8px';
  const search = document.createElement('input'); search.className='input'; search.placeholder='Search images...'; search.oninput = ()=> renderImageGrid(search.value);
  top.appendChild(search);
  const urlbtn = document.createElement('button'); urlbtn.className='btn ghost'; urlbtn.innerText='Add URL'; urlbtn.onclick = ()=>{ const url = prompt('Image URL'); if(url){ const name = prompt('Name (optional)')||url.split('/').pop().slice(0,20); state.images.unshift({ id:'img'+uid(), name, data: url, createdAt:Date.now() }); save(); renderImageLibrary(area); } };
  top.appendChild(urlbtn);
  const upbtn = document.createElement('button'); upbtn.className='btn ghost'; upbtn.innerText='Upload'; upbtn.onclick = ()=>{ const inp = document.createElement('input'); inp.type='file'; inp.accept='image/*'; inp.onchange = (e)=>{ const f=e.target.files[0]; if(!f) return; const reader=new FileReader(); reader.onload=()=>{ state.images.unshift({ id:'img'+uid(), name:f.name, data:reader.result, createdAt:Date.now() }); save(); renderImageLibrary(area); }; reader.readAsDataURL(f); }; inp.click(); };
  top.appendChild(upbtn);
  area.appendChild(top);
  const grid = document.createElement('div'); grid.id='imgGrid'; grid.className='grid'; grid.style.marginTop='12px';
  function renderImageGrid(q=''){ grid.innerHTML=''; state.images.filter(i=> i.name.toLowerCase().includes((q||'').toLowerCase()) || i.id.includes(q)).forEach(img=>{
    const el = document.createElement('div'); el.className='card-click';
    el.innerHTML = '<img src="'+img.data+'" class="img-thumb"/><div class="small" style="margin-top:6px">'+escapeHtml(img.name)+'</div>';
    const row = document.createElement('div'); row.style.display='flex'; row.style.justifyContent='space-between'; row.style.marginTop='6px';
    const use = document.createElement('button'); use.className='btn ghost'; use.innerText='Use'; use.onclick = ()=>{ prompt('Image id to copy/use: '+img.id); };
    const del = document.createElement('button'); del.className='btn ghost'; del.style.color='red'; del.innerText='Delete'; del.onclick = ()=>{ if(confirm('Delete?')){ state.images = state.images.filter(x=>x.id!==img.id); save(); renderImageLibrary(area); } };
    row.appendChild(use); row.appendChild(del); el.appendChild(row);
    grid.appendChild(el);
  }); area.appendChild(grid); }
  renderImageGrid('');
}

function playGame(tab){
  const g = state.games[tab];
  if(!g) return;
  const area = document.getElementById('playArea'); area.style.display='block'; area.innerHTML = '<h3>'+escapeHtml(g.title)+'</h3>';
  if(g.type==='pairs' || tab==='pairs'){
    const cards = g.items.map((it,i)=>({...it,_i:i})); shuffle(cards);
    const grid = document.createElement('div'); grid.className='grid'; area.appendChild(grid);
    let first=null, second=null;
    cards.forEach((c,idx)=>{
      const el = document.createElement('div'); el.className='card-click'; el.style.height='100px'; el.style.display='flex'; el.style.alignItems='center'; el.style.justifyContent='center';
      el.innerHTML = '<div style="font-size:22px">?</div>';
      el.onclick = ()=>{
        if(el.dataset.matched) return;
        if(c.kind==='image') el.innerHTML = '<img src="'+c.content+'" style="max-width:120px;max-height:80px"/>'; else el.innerHTML = '<div>'+escapeHtml(c.content)+'</div>';
        if(!first){ first={c,el,idx}; } else if(!second && idx!==first.idx){ second={c,el,idx};
          if(first.c.pairId === second.c.pairId){ first.el.style.visibility='hidden'; second.el.style.visibility='hidden'; first.el.dataset.matched=true; second.el.dataset.matched=true; first=null; second=null; if(Array.from(grid.children).every(ch=>ch.style.visibility==='hidden')) setTimeout(()=>alert(g.language==='ar'?'مبروك!':'Well done!'),200); }
          else setTimeout(()=>{ first.el.innerHTML = '<div style="font-size:22px">?</div>'; second.el.innerHTML = '<div style="font-size:22px">?</div>'; first=null; second=null; },700);
        }
      };
      grid.appendChild(el);
    });
    area.scrollIntoView({behavior:'smooth'});
  } else if(tab==='flash'){
    const wrap = document.createElement('div'); wrap.style.display='flex'; wrap.style.gap='12px'; g.items.forEach(it=>{ const c = document.createElement('div'); c.className='card'; c.style.padding='16px'; c.innerHTML = '<div style="font-weight:700">'+escapeHtml(it.front||'')+'</div><div style="margin-top:8px">'+escapeHtml(it.back||'')+'</div>'; wrap.appendChild(c); }); area.appendChild(wrap);
  } else if(tab==='matching'){
    const left = document.createElement('div'); left.style.padding='8px'; left.style.border='1px solid #eee'; left.innerHTML='<h4>Left</h4>'; const right = document.createElement('div'); right.style.padding='8px'; right.style.border='1px solid #eee'; right.innerHTML='<h4>Right</h4>'; g.items.forEach(it=>{ left.appendChild(document.createElement('div')).innerText = it.left || ''; right.appendChild(document.createElement('div')).innerText = it.right || ''; }); const grid = document.createElement('div'); grid.style.display='flex'; grid.style.gap='12px'; grid.appendChild(left); grid.appendChild(right); area.appendChild(grid);
  } else if(tab==='mcq'){
    const qwrap = document.createElement('div'); g.items.forEach(q=>{ const card = document.createElement('div'); card.className='card'; card.innerHTML = '<div style="font-weight:700">'+escapeHtml(q.question)+'</div>'; q.choices.forEach((c,i)=>{ const btn = document.createElement('button'); btn.className='btn ghost'; btn.style.display='block'; btn.style.marginTop='6px'; btn.innerText = c; btn.onclick = ()=>{ if(i===q.answerIndex) alert('Correct'); else alert('Wrong'); }; card.appendChild(btn); }); qwrap.appendChild(card); }); area.appendChild(qwrap);
  }
}

function shuffle(a){ for(let i=a.length-1;i>0;i--){ const j = Math.floor(Math.random()*(i+1)); [a[i],a[j]]=[a[j],a[i]]; } }

function saveAll(){ save(); alert('Saved locally'); }
function downloadAll(){ Object.keys(state.games).forEach(k=>{ const html = generateStandalone(state.games[k]); const blob = new Blob([html],{type:'text/html'}); const url = URL.createObjectURL(blob); const a = document.createElement('a'); a.href=url; a.download = (state.games[k].title||k)+'.html'; a.click(); URL.revokeObjectURL(url); }); }

function generateStandalone(game){
  const payload = JSON.stringify(game).replace(/</g,'\\u003c');
  return `<!doctype html><html lang="${game.language||'en'}"><head><meta charset="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1"/><title>${escapeHtml(game.title||'Game')}</title><style>body{font-family:Arial,Helvetica,sans-serif;padding:12px}.card{border-radius:8px;padding:10px;border:1px solid #ddd;margin:8px;display:inline-block}.grid{display:flex;flex-wrap:wrap;gap:8px}</style></head><body><h1>${escapeHtml(game.title||'Game')}</h1><div id='root'></div><script>const GAME=${payload};(function(){const root=document.getElementById('root');if(GAME.type==='pairs'){const cards=GAME.items.map((it,i)=>({...it,_i:i}));for(let i=cards.length-1;i>0;i--){const j=Math.floor(Math.random()*(i+1));[cards[i],cards[j]]=[cards[j],cards[i]]}const container=document.createElement('div');container.className='grid';let first=null,second=null;cards.forEach((c,idx)=>{const el=document.createElement('div');el.className='card';el.style.width='140px';el.style.height='90px';el.style.display='flex';el.style.alignItems='center';el.style.justifyContent='center';el.textContent='?';el.onclick=function(){if(el.dataset.matched)return;if(c.kind==='image'){el.innerHTML='';const img=document.createElement('img');img.src=c.content;img.style.maxWidth='120px';img.style.maxHeight='80px';el.appendChild(img);}else el.textContent=c.content;if(!first)first={c,el};else if(!second && el!==first.el){second={c,el};if(first.c.pairId===second.c.pairId){first.el.style.visibility='hidden';second.el.style.visibility='hidden';first.el.dataset.matched=true;second.el.dataset.matched=true;first=null;second=null;if(Array.from(container.children).every(ch=>ch.style.visibility==='hidden'))setTimeout(()=>alert('Well done!'),200);}else setTimeout(()=>{first.el.textContent='?';second.el.textContent='?';first.el.innerHTML='';second.el.innerHTML='';first=null;second=null;},700);}};container.appendChild(el)});root.appendChild(container);}else{root.textContent='No player for this type.'}})();</script></body></html>`;
}

function setUiLang(v){
  document.documentElement.lang = v;
  if(v==='ar'){
    document.getElementById('siteTitle').innerText='ألعاب بسمة';
    document.getElementById('pageTitle').innerText='استوديو الألعاب';
    document.getElementById('pageSub').innerText='صممي ولعبّي ألعاب تعليمية';
    document.querySelectorAll('.tab').forEach(t=>{ const m = {'pairs':'مطابقة الأزواج','flash':'فلاش كارد','matching':'مطابقة','mcq':'اختبار','library':'مكتبة الصور'}; if(m[t.dataset.tab]) t.innerText = m[t.dataset.tab]; });
  } else {
    document.getElementById('siteTitle').innerText='Basma Games';
    document.getElementById('pageTitle').innerText='Game Studio';
    document.getElementById('pageSub').innerText='Choose a template and edit.';
    document.querySelectorAll('.tab').forEach(t=> t.innerText = ({pairs:'Match in Pairs',flash:'Flashcards',matching:'Matching',mcq:'Quiz (MCQ)',library:'Image Library'})[t.dataset.tab] || t.dataset.tab );
  }
}

function escapeHtml(s){ return String(s||'').replaceAll('&','&amp;').replaceAll('<','&lt;').replaceAll('>','&gt;').replaceAll('"','&quot;'); }

function goBack(){ history.back(); }

// init
load();
setUiLang('en');
</script>
</body>
</html>
